<div class="flex justify-between mt-3"
     data-controller="permission">
  <h2 class="text-2xl font-bold">會議室目錄</h2>
  <%= link_to "新增會議室", rooms_path(), method: "post", target: "_blank", class: "btn-dashboard-create",data: {action: "permission#checkPermission", "permission-target": "control_button","create-permission": "enable"}%>
  
</div>
<span class="block mb-10">管理您的會議室，新增會議、進行查詢、調整及刪除。</span>
<div>
  <form action="./rooms" method="get" class="mt-2 mb-4">
    搜尋：<input type="text" placeholder="關鍵字查詢" name="keyword" class="px-2 border border-black">
    <button>送出</button>
  </form>
</div>
<div data-controller="room"
     data-currentUserId=<%= current_user.id %>>
  <div class="p-5 text-white bg-gray-800">
    <label><input type="checkbox" class="mx-5" data-room-target="filterCurrentUserButton" 
                                               data-action="click->room#filter">Only search my pads</label>
  </div>
  <table class="room_table">
    <thead>
      <tr>
        <td>標題</td>
        <td>狀態</td>
        <td>模式</td>
        <td>程式語言</td>
        <td>建立者</td>
        <td>建立日期</td>
        <td></td>
        <td></td>
      </tr>
    </thead>
    <tbody data-room-target="roomTable">
      <% @rooms.each do | room | %>
        <tr>
          <td><%= room.title %></td>
          <td><%= room.status %></td>
          <td><%= room.category %></td>
          <td><%= room.language %></td>
          <td><%= room.creator.username %></td>
          <td><%= room.created_at.to_s.split.first %></td>
          <td><%= link_to "檢視", room_uuid_path(uuid: room.uuid), class: "btn-dashboard-create" %></td>
          <%# TODO 要更改plan ＝ vip  %>
          <% if (Time.now-room.created_at)/3600 > 24 || current_user.team.plan == ""%>
            <td><%= link_to "刪除", room, method:"delete", data:{confirm:"Delete Room? Are you sure?"}, class: "btn-dashboard-delete" %></td>
          <% else %>
            <td data-room-target="countdown"
                data-room_uuid=<%= room.uuid %>
                class="whitespace-pre"><svg class="animate-spin mx-4 h-8 w-8 text-gray-700" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg></td>
          <% end %>
        </tr>
      <% end %>
    </tbody>
  </table>
</div>
